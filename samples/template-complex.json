{
  "templateId": "complex_welding_v2",
  "templateName": "Precision Welding Job (AWS D1.1)",
  "description": "Advanced welding process with parallel preparation, conditional rework, and full compliance tracking",
  "version": "2.1.0",
  "customFields": [
    {
      "fieldId": "plateQuantity",
      "label": "Steel Plate Quantity",
      "type": "number",
      "required": true,
      "min": 1,
      "max": 100,
      "unit": "sheets",
      "defaultValue": 10
    },
    {
      "fieldId": "weldingType",
      "label": "Welding Type",
      "type": "select",
      "options": ["MIG", "TIG", "Stick"],
      "required": true,
      "defaultValue": "MIG"
    },
    {
      "fieldId": "certLevel",
      "label": "Required Certification Level",
      "type": "select",
      "options": ["AWS D1.1", "AWS D1.1 Advanced", "ASME IX"],
      "required": true,
      "defaultValue": "AWS D1.1"
    },
    {
      "fieldId": "materialGrade",
      "label": "Steel Grade",
      "type": "select",
      "options": ["A36", "A572", "A992"],
      "required": true,
      "defaultValue": "A36"
    },
    {
      "fieldId": "clientPO",
      "label": "Client Purchase Order",
      "type": "text",
      "required": true
    }
  ],
  "stages": [
    {
      "stageId": "prep",
      "stageName": "Preparation",
      "order": 1,
      "dependsOn": [],
      "condition": "succeeded()",
      "steps": [
        {
          "stepId": "material_check",
          "stepName": "Material Inspection - ${plateQuantity} ${materialGrade} plates",
          "description": "Verify ${plateQuantity} steel plates (Grade ${materialGrade}) meet ASTM specifications",
          "order": 1,
          "dependsOn": [],
          "condition": "succeeded()",
          "requirements": [
            {
              "requirementType": "material",
              "name": "Steel Plate Grade ${materialGrade}",
              "quantity": "${plateQuantity}",
              "unit": "sheets",
              "specification": "ASTM ${materialGrade}",
              "required": true
            },
            {
              "requirementType": "tool",
              "toolId": "micrometer_001",
              "toolName": "Digital Micrometer (0.001mm accuracy)",
              "calibrationRequired": true,
              "lastCalibrationDate": "2025-10-01",
              "required": true
            },
            {
              "requirementType": "tool",
              "toolId": "scale_001",
              "toolName": "Digital Scale",
              "calibrationRequired": true,
              "required": false
            },
            {
              "requirementType": "document",
              "name": "Material Certificate",
              "documentType": "pdf",
              "uploadRequired": true,
              "required": true
            }
          ],
          "qaTemplateId": "material_inspection_v2",
          "estimatedDuration": 30
        },
        {
          "stepId": "equipment_setup",
          "stepName": "Setup ${weldingType} Welding Equipment",
          "description": "Prepare and calibrate ${weldingType} welder according to WPS",
          "order": 2,
          "dependsOn": [],
          "condition": "succeeded()",
          "requirements": [
            {
              "requirementType": "tool",
              "toolId": "welder_mig_300",
              "toolName": "${weldingType} Welder 300A",
              "calibrationRequired": true,
              "lastCalibrationDate": "2025-09-15",
              "required": true
            },
            {
              "requirementType": "user",
              "name": "Qualified Equipment Technician",
              "allowedRoles": ["technician", "supervisor", "welder"],
              "minExperienceYears": 2,
              "required": true
            },
            {
              "requirementType": "document",
              "name": "Welding Procedure Specification (WPS)",
              "documentType": "pdf",
              "required": true
            }
          ],
          "qaTemplateId": "equipment_setup_v1",
          "estimatedDuration": 45
        }
      ]
    },
    {
      "stageId": "welding",
      "stageName": "Welding Operations",
      "order": 2,
      "dependsOn": ["prep"],
      "condition": "succeeded()",
      "steps": [
        {
          "stepId": "weld_primary",
          "stepName": "Primary ${weldingType} Welding - PO: ${clientPO}",
          "description": "Execute welding per WPS using ${weldingType} process. Maintain temperature log.",
          "order": 1,
          "dependsOn": ["material_check", "equipment_setup"],
          "condition": "succeeded()",
          "requirements": [
            {
              "requirementType": "qualification",
              "certificationId": "${certLevel}",
              "certificationName": "AWS Welding Certification ${certLevel}",
              "expirationCheck": true,
              "required": true
            },
            {
              "requirementType": "material",
              "name": "Welding Wire ER70S-6",
              "quantity": 5,
              "unit": "kg",
              "specification": "AWS A5.18",
              "required": true
            },
            {
              "requirementType": "material",
              "name": "Shielding Gas (75% Argon / 25% CO2)",
              "quantity": 2,
              "unit": "cylinders",
              "required": true
            },
            {
              "requirementType": "user",
              "name": "Certified Welder",
              "allowedRoles": ["welder", "senior_welder"],
              "minExperienceYears": 3,
              "requiredQualifications": ["${certLevel}"],
              "required": true
            },
            {
              "requirementType": "tool",
              "toolId": "temp_logger_001",
              "toolName": "Temperature Data Logger",
              "calibrationRequired": true,
              "required": true
            }
          ],
          "qaTemplateId": "welding_process_v3",
          "estimatedDuration": 120,
          "outputs": [
            {
              "outputType": "artifact",
              "name": "Welded Assembly",
              "quantity": 1,
              "passToSteps": ["qa_inspection"],
              "storageLocation": "Bay 3, Rack A",
              "requiredForCompletion": true
            },
            {
              "outputType": "data",
              "name": "Weld Temperature Log",
              "dataType": "number[]",
              "passToSteps": ["qa_inspection"],
              "requiredForAnalytics": true
            },
            {
              "outputType": "document",
              "name": "Welding Log Sheet",
              "documentType": "pdf",
              "template": "welding_log_template_v2",
              "requiredForCompletion": true
            }
          ]
        }
      ]
    },
    {
      "stageId": "qa",
      "stageName": "Quality Assurance",
      "order": 3,
      "dependsOn": ["welding"],
      "condition": "succeeded()",
      "steps": [
        {
          "stepId": "qa_inspection",
          "stepName": "NDT Inspection & Dimensional Check",
          "description": "Non-destructive testing and dimensional verification per acceptance criteria",
          "order": 1,
          "dependsOn": ["weld_primary"],
          "condition": "succeeded()",
          "requirements": [
            {
              "requirementType": "qualification",
              "certificationId": "NDT_LEVEL_II",
              "certificationName": "NDT Level II Inspector (UT/MT)",
              "expirationCheck": true,
              "required": true
            },
            {
              "requirementType": "tool",
              "toolId": "ut_equipment_001",
              "toolName": "Ultrasonic Testing Equipment",
              "calibrationRequired": true,
              "lastCalibrationDate": "2025-10-15",
              "required": true
            },
            {
              "requirementType": "tool",
              "toolId": "mt_equipment_001",
              "toolName": "Magnetic Particle Testing Equipment",
              "calibrationRequired": false,
              "required": true
            },
            {
              "requirementType": "approval",
              "name": "QA Manager Sign-off",
              "approverRole": "qa_manager",
              "approvalType": "manual",
              "required": true
            },
            {
              "requirementType": "document",
              "name": "Inspection Acceptance Criteria",
              "documentType": "pdf",
              "required": true
            }
          ],
          "qaTemplateId": "ndt_inspection_v2",
          "estimatedDuration": 60,
          "outputs": [
            {
              "outputType": "document",
              "name": "NDT Inspection Report",
              "documentType": "pdf",
              "requiredForCompletion": true
            },
            {
              "outputType": "approval",
              "name": "QA Manager Approval",
              "approverRole": "qa_manager",
              "requiredForNextStage": true
            }
          ]
        }
      ]
    },
    {
      "stageId": "rework",
      "stageName": "Rework (Conditional)",
      "order": 4,
      "dependsOn": ["qa"],
      "condition": "failed()",
      "steps": [
        {
          "stepId": "rework_weld",
          "stepName": "Corrective Welding - Rework",
          "description": "Address defects identified during QA inspection. Document corrective actions.",
          "order": 1,
          "dependsOn": ["qa_inspection"],
          "condition": "failed()",
          "requirements": [
            {
              "requirementType": "qualification",
              "certificationId": "${certLevel}",
              "certificationName": "AWS Welding Certification ${certLevel}",
              "required": true
            },
            {
              "requirementType": "approval",
              "name": "Rework Authorization",
              "approverRole": "production_manager",
              "required": true
            },
            {
              "requirementType": "document",
              "name": "Non-Conformance Report (NCR)",
              "documentType": "pdf",
              "uploadRequired": true,
              "required": true
            }
          ],
          "qaTemplateId": "rework_log_v1",
          "estimatedDuration": 90,
          "outputs": [
            {
              "outputType": "document",
              "name": "Rework Documentation",
              "documentType": "pdf",
              "requiredForCompletion": true
            }
          ]
        },
        {
          "stepId": "rework_inspection",
          "stepName": "Re-inspection After Rework",
          "description": "Verify rework meets acceptance criteria",
          "order": 2,
          "dependsOn": ["rework_weld"],
          "condition": "succeeded()",
          "requirements": [
            {
              "requirementType": "qualification",
              "certificationId": "NDT_LEVEL_II",
              "certificationName": "NDT Level II Inspector",
              "required": true
            },
            {
              "requirementType": "approval",
              "name": "Final QA Approval",
              "approverRole": "qa_manager",
              "required": true
            }
          ],
          "qaTemplateId": "reinspection_v1",
          "estimatedDuration": 45
        }
      ]
    },
    {
      "stageId": "cleanup",
      "stageName": "Cleanup & Documentation",
      "order": 5,
      "dependsOn": ["qa", "rework"],
      "condition": "always()",
      "steps": [
        {
          "stepId": "cleanup_workspace",
          "stepName": "Clean and Store Equipment",
          "description": "Clean work area, store equipment, dispose of waste properly",
          "order": 1,
          "dependsOn": [],
          "condition": "always()",
          "requirements": [
            {
              "requirementType": "material",
              "name": "Waste disposal containers",
              "quantity": 1,
              "unit": "set",
              "required": true
            }
          ],
          "checklist": [
            "Work area cleaned",
            "Equipment stored properly",
            "Waste disposed per regulations",
            "Tools returned to storage"
          ],
          "estimatedDuration": 20
        },
        {
          "stepId": "finalize_docs",
          "stepName": "Finalize Job Documentation",
          "description": "Compile all documentation, upload to system, archive physical copies",
          "order": 2,
          "dependsOn": ["cleanup_workspace"],
          "condition": "always()",
          "requirements": [
            {
              "requirementType": "document",
              "name": "Job Traveler Packet",
              "documentType": "pdf",
              "required": true
            }
          ],
          "checklist": [
            "All required documents present",
            "Documents signed and dated",
            "Digital copies uploaded",
            "Physical copies filed",
            "Client PO ${clientPO} referenced"
          ],
          "outputs": [
            {
              "outputType": "document",
              "name": "Complete Job Package",
              "documentType": "pdf",
              "requiredForCompletion": true
            }
          ],
          "estimatedDuration": 15
        }
      ]
    }
  ],
  "createdAt": "2025-11-01T00:00:00Z",
  "createdBy": "system"
}
